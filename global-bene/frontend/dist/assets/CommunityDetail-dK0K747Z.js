import{j as e}from"./ui-BaUVVAjf.js";import{c as $,r,L as k}from"./router-DiqerDgP.js";import{P as R}from"./PostCard-hk6ZiPN9.js";import T from"./CreatePost-DlGY833L.js";import{c as o}from"./index-DDEPdpRf.js";import{a as z}from"./authService-BKeytffR.js";import"./vendor-Bzgz95E1.js";import"./postService-B9nmksEV.js";import"./CommentSection-BssdT6Od.js";import"./reportService-D7gKbnWI.js";function ee(){const{id:a}=$(),[s,c]=r.useState(null),[S,g]=r.useState(!0),[x,M]=r.useState(""),[d,h]=r.useState(!1),[y,b]=r.useState(!1),[_,m]=r.useState(!1),[I,f]=r.useState([]),[p,E]=r.useState([]),[L,u]=r.useState(!1),[A,O]=r.useState(!1),[l,U]=r.useState(null),[w,j]=r.useState(!1);r.useEffect(()=>{P(),g(!0),o.getCommunityById(a).then(t=>{c(t.data);const n=sessionStorage.getItem("user")?JSON.parse(sessionStorage.getItem("user")):null;n&&t.data.members&&h(t.data.members.some(i=>i._id===n._id))}).catch(()=>M("Could not load community")).finally(()=>g(!1)),o.getUserCommunities().then(t=>f(t.data.communities||[])).catch(()=>f([]))},[a,d]);const P=async()=>{try{const t=await z.getMe();U(t.data)}catch(t){console.error("Error loading current user:",t)}},v=async()=>{try{const t=await o.getCommunityMembers(a);E(t.data.members||[])}catch(t){console.error("Error loading members:",t)}},J=async()=>{b(!0);try{await o.toggleJoinCommunity(a);const t=await o.getCommunityById(a);c(t.data);const n=sessionStorage.getItem("user")?JSON.parse(sessionStorage.getItem("user")):null;n&&t.data.members&&h(t.data.members.some(i=>i._id===n._id))}catch(t){console.error("Error toggling membership:",t)}finally{b(!1)}},B=async()=>{if(window.confirm("Are you sure you want to delete this community? This action cannot be undone.")){j(!0);try{await o.deleteCommunity(a),alert("Community deleted successfully"),window.location.href="/communities"}catch(t){console.error("Error deleting community:",t),alert("Failed to delete community")}finally{j(!1)}}},D=async(t,n)=>{if(window.confirm(`Are you sure you want to remove ${n} from this community?`))try{await o.removeMember(a,t),await v();const i=await o.getCommunityById(a);c(i.data)}catch(i){console.error("Error removing member:",i),alert("Failed to remove member")}},N=l&&s&&l._id===s.creator._id,F=l&&s&&s.moderators&&s.moderators.some(t=>t._id===l._id),C=N||F;return S?e.jsx("div",{className:"p-8 text-center text-gray-700 dark:text-gray-200",children:"Loadingâ€¦"}):x?e.jsx("div",{className:"p-8 text-center text-red-600 dark:text-red-400",children:x}):s?e.jsxs("div",{className:"max-w-4xl mx-auto my-10",children:[s.bannerUrl&&e.jsx("img",{src:s.bannerUrl,alt:"community banner",className:"w-full rounded-xl mb-6 max-h-56 object-cover"}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.iconUrl||"https://www.gravatar.com/avatar/?d=mp",alt:s.displayName,className:"w-16 h-16 rounded-full object-cover border-2 border-orange-500"}),e.jsxs("span",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["r/",s.name]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:s.displayName}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.memberCount||0," members"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[sessionStorage.getItem("accessToken")&&e.jsx("button",{onClick:J,disabled:y,className:`px-6 py-2 rounded-lg font-semibold ${d?"bg-gray-500 hover:bg-gray-600 text-white":"bg-orange-500 hover:bg-orange-600 text-white"} disabled:opacity-50`,children:y?"...":d?"Leave":"Join"}),C&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{u(!0),v()},className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold",children:"Members"}),N&&e.jsxs(e.Fragment,{children:[e.jsx(k,{to:`/community/${s._id}/edit`,className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold",children:"Edit Community"}),e.jsx("button",{onClick:B,disabled:w,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold disabled:opacity-50",children:w?"Deleting...":"Delete Community"})]})]})]})]}),s.description&&e.jsx("p",{className:"text-gray-800 dark:text-gray-100 mb-8",children:s.description}),sessionStorage.getItem("accessToken")&&d&&e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>m(!0),className:"bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-semibold",children:"Create Post"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Posts"}),e.jsx("div",{className:"space-y-4",children:(s.posts||[]).length===0?e.jsx("div",{className:"p-8 text-center text-gray-600 dark:text-gray-300 rounded",children:"No posts in this community yet."}):s.posts.map(t=>e.jsx(R,{post:t,onUpdate:()=>{}},t._id))}),_&&e.jsx(T,{onClose:()=>m(!1),onSuccess:()=>{m(!1),o.getCommunityById(a).then(t=>c(t.data))},communities:I}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Community Members (",p.length,")"]}),e.jsx("button",{onClick:()=>u(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"space-y-3",children:p.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.user.profile?.avatarUrl||"https://www.gravatar.com/avatar/?d=mp",alt:t.user.username,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{children:[e.jsx(k,{to:`/profile/${t.user._id}`,className:"font-medium text-gray-900 dark:text-white hover:text-orange-500",onClick:()=>u(!1),children:t.user.username}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:t.role})]})]}),C&&t.role!=="creator"&&t.user._id!==l._id&&e.jsx("button",{onClick:()=>D(t.user._id,t.user.username),className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-sm rounded-lg",children:"Remove"})]},t.user._id))})]})})})]}):null}export{ee as default};
