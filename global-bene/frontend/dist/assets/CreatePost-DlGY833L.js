import{j as e}from"./ui-BaUVVAjf.js";import{r as o}from"./router-DiqerDgP.js";import{p as y}from"./postService-B9nmksEV.js";import"./vendor-Bzgz95E1.js";import"./index-DDEPdpRf.js";function L({onClose:f,onSuccess:C,communities:S,editPost:r}){const[a,k]=o.useState({title:"",textContent:"",communityId:"",linkUrl:"",linkTitle:""}),[m,I]=o.useState(null),[v,x]=o.useState(null),[w,p]=o.useState(!1),[j,b]=o.useState(""),d=!!r;o.useEffect(()=>{r&&(k({title:r.title||"",textContent:r.content?.text||r.content||"",communityId:r.community?._id||"",linkUrl:r.content?.links?.[0]?.url||r.linkUrl||"",linkTitle:r.content?.links?.[0]?.title||""}),h(r.community?"community":"user"),N(r.category||"general"),r.content?.images?.[0]?.secure_url?x(r.content.images[0].secure_url):r.imageUrl&&x(r.imageUrl))},[r]);const c=l=>{k({...a,[l.target.name]:l.target.value})},T=async l=>{l.preventDefault(),p(!0),b("");try{const t={};a.textContent.trim()&&(t.text=a.textContent.trim()),m&&new FormData().append("image",m),a.linkUrl.trim()&&(t.links=[{url:a.linkUrl.trim(),title:a.linkTitle.trim()||a.linkUrl.trim()}]);let n;if(d){const s={title:a.title,category:u};if((t.text||t.images&&t.images.length>0||t.links&&t.links.length>0)&&(s.content=t),m){const i=new FormData;i.append("title",a.title),(t.text||t.images&&t.images.length>0||t.links&&t.links.length>0)&&i.append("content",JSON.stringify(t)),i.append("category",u),i.append("image",m),n=await y.updatePost(r._id,i)}else n=await y.updatePost(r._id,s)}else{const s={title:a.title,category:u,tags:[]};if((t.text||t.images&&t.images.length>0||t.links&&t.links.length>0)&&(s.content=t),g==="community"&&a.communityId&&(s.communityId=a.communityId),m){const i=new FormData;i.append("title",a.title),(t.text||t.images&&t.images.length>0||t.links&&t.links.length>0)&&i.append("content",JSON.stringify(t)),i.append("category",u),g==="community"&&a.communityId&&i.append("communityId",a.communityId),i.append("image",m),n=await y.createPost(i)}else n=await y.createPost(s);if(n.data?.requiresConfirmation&&n.data?.spamWarning){if(!window.confirm(`This post might be considered spam and may be flagged. Do you want to proceed? Proceeding may cause restrictions or admin review.

Reason: ${n.data.spamReason}
Confidence: ${(n.data.spamConfidence*100).toFixed(1)}%`)){p(!1);return}alert("Your post has been flagged for review. It will be visible after admin approval."),p(!1);return}}C()}catch(t){const n=t.response?.data;n?.spamDetected?b(`Spam detected: ${n.spamReason}. Your post cannot be created.`):b(n?.message||t.message||`Error ${d?"updating":"creating"} post`)}finally{p(!1)}},U=[{label:"General",value:"general"},{label:"Tech",value:"tech"},{label:"Sports",value:"sports"},{label:"Political",value:"political"},{label:"Entertainment",value:"entertainment"},{label:"News",value:"news"},{label:"Health",value:"health"},{label:"Other",value:"other"}],[g,h]=o.useState("community"),[u,N]=o.useState("general");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-slate-50 dark:bg-slate-900 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-300 dark:border-gray-700 shadow-xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d?"Edit Post":"Create Post"}),e.jsx("button",{onClick:f,className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300",children:"âœ•"})]}),j&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded",children:j}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[!d&&e.jsxs("div",{className:"flex items-center gap-8 mb-4",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"postType",value:"community",checked:g==="community",onChange:()=>h("community")})," Community Post"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"postType",value:"user",checked:g==="user",onChange:()=>h("user")})," User Post"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"You can add text, an image, and/or a link to your post (all optional except title)"}),g==="community"&&!d&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Community *"}),e.jsxs("select",{name:"communityId",value:a.communityId,onChange:c,required:!0,className:"w-full p-2 border border-gray-400 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 shadow",children:[e.jsx("option",{value:"",children:"Select a community"}),S.map(l=>e.jsxs("option",{value:l._id,children:["g/",l.name]},l._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Category *"}),e.jsx("select",{name:"category",value:u,onChange:l=>N(l.target.value),required:!0,className:"w-full p-2 border border-gray-400 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 shadow",children:U.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Title *"}),e.jsx("input",{type:"text",name:"title",value:a.title,onChange:c,required:!0,maxLength:300,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Post title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Text Content (optional)"}),e.jsx("textarea",{name:"textContent",value:a.textContent,onChange:c,rows:4,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none",placeholder:"What's on your mind?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Image (optional)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:l=>{const t=l.target.files?.[0];if(I(t),t){const n=new FileReader;n.onload=s=>x(s.target.result),n.readAsDataURL(t)}else x(null)},className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),v&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:v,alt:"Preview",className:"max-w-full h-32 object-cover rounded-lg"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Link URL (optional)"}),e.jsx("input",{type:"url",name:"linkUrl",value:a.linkUrl,onChange:c,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white mb-2",placeholder:"https://example.com"}),e.jsx("input",{type:"text",name:"linkTitle",value:a.linkTitle,onChange:c,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Link title (optional)"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w,className:"px-4 py-2 bg-orange-600 dark:bg-orange-400 text-white dark:text-slate-900 rounded-lg font-semibold disabled:opacity-50 shadow hover:bg-orange-700 dark:hover:bg-orange-300 transition",children:w?d?"Updating...":"Posting...":d?"Update":"Post"})]})]})]})})})}export{L as default};
