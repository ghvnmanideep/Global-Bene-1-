import{j as e}from"./ui-BaUVVAjf.js";import{r as i,b as x,L as T}from"./router-DiqerDgP.js";import{p as F}from"./postService-B9nmksEV.js";import{C as G,c as H}from"./CommentSection-BssdT6Od.js";import{a as g}from"./authService-BKeytffR.js";import{r as J}from"./reportService-D7gKbnWI.js";function Y({userId:p,onClose:m}){const[s,w]=x.useState(null),[I,C]=x.useState(!0),[f,y]=x.useState(null),[k,u]=x.useState(!1),[c,h]=x.useState(!1);x.useEffect(()=>{async function a(){try{h(!1),C(!0);const d=await g.getUserById(p);w(d.data);const v=await g.getMe();y(v.data)}catch{h(!0)}finally{C(!1)}}a()},[p]);const b=f&&s&&f._id===s._id,N=f&&s&&f.following&&f.following.some(a=>(typeof a=="object"?a._id:a)===s._id),P=async()=>{try{u(!0),await g.followUser(s._id);const a=await g.getUserById(s._id);w(a.data);const d=await g.getMe();y(d.data)}catch(a){console.error("Follow error:",a),alert(a?.response?.data?.message||"Failed to follow user")}finally{u(!1)}},S=async()=>{try{u(!0),await g.unfollowUser(s._id);const a=await g.getUserById(s._id);w(a.data);const d=await g.getMe();y(d.data)}catch(a){console.error("Unfollow error:",a),alert(a?.response?.data?.message||"Failed to unfollow user")}finally{u(!1)}};if(I||!s)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl p-8 w-full max-w-sm relative",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-orange-500 mb-3"}),e.jsx("div",{className:"text-center text-gray-700 dark:text-gray-50",children:"Loading profile..."})]}),e.jsx("button",{onClick:m,className:"absolute top-3 right-5 text-lg",children:"×"})]})});if(c)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl p-8 w-full max-w-sm relative flex flex-col items-center",children:[e.jsx("div",{className:"text-red-500 text-center font-bold",children:"User not found or unavailable."}),e.jsx("button",{onClick:m,className:"mt-5 px-5 py-2 rounded-full bg-orange-500 text-white font-semibold shadow hover:bg-orange-600",children:"Close"})]})});const L=s.followers?.length||0,j=s.following?.length||0;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",onClick:m,children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl p-7 w-full max-w-sm relative",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:m,className:"absolute top-2 right-4 text-lg text-gray-500 hover:text-orange-600",children:"×"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:s.profile?.avatarUrl||"https://www.gravatar.com/avatar/?d=mp",className:"w-20 h-20 rounded-full border-4 border-orange-300 shadow mb-2",alt:"avatar"}),e.jsx("h2",{className:"text-xl font-bold mb-0.5",children:s.username}),e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:s.email}),s.profile?.bio&&e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-200 mb-2 italic text-center border-l-4 border-orange-200 pl-2",children:s.profile.bio}),e.jsxs("div",{className:"flex gap-6 my-1 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:L}),e.jsx("div",{className:"text-xs text-gray-600",children:"Followers"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:s.posts?.length||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Posts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:j}),e.jsx("div",{className:"text-xs text-gray-600",children:"Following"})]})]}),!b&&(N?e.jsx("button",{disabled:k,onClick:S,className:"bg-orange-200 text-orange-900 px-4 py-1 rounded-full shadow hover:bg-orange-300 font-semibold transition disabled:opacity-60 w-full",children:k?"Unfollowing...":"Unfollow"}):e.jsx("button",{disabled:k,onClick:P,className:"bg-orange-500 text-white px-4 py-1 rounded-full shadow hover:bg-orange-600 font-semibold transition disabled:opacity-60 w-full",children:k?"Following...":"Follow"})),e.jsx(T,{to:`/profile/${s._id}`,onClick:m,className:"block mt-4 px-4 py-1 rounded-full font-semibold text-orange-700 hover:bg-orange-100 text-xs border border-orange-200 transition",children:"Go to full profile"})]})]})})}function re({post:p,onUpdate:m}){const[s,w]=i.useState(!1),[I,C]=i.useState(""),[f,y]=i.useState([]),[k,u]=i.useState(!1),[c,h]=i.useState(null),[b,N]=i.useState(!1),[P,S]=i.useState(!1),[L,j]=i.useState(!1),[a,d]=i.useState(!1),[v,U]=i.useState(""),[z,A]=i.useState(!1),[t,$]=i.useState(p),l=(()=>{try{const r=sessionStorage.getItem("user");if(r){const o=JSON.parse(r);if(o&&o._id)return o._id}const n=sessionStorage.getItem("accessToken");if(n)try{const o=JSON.parse(atob(n.split(".")[1]));if(o&&o.id)return o.id}catch(o){console.warn("Failed to decode token:",o)}}catch(r){console.error("Error getting user info:",r)}return null})();x.useEffect(()=>{$(p)},[p]),x.useEffect(()=>{l&&Array.isArray(t.upvotes)&&h(t.upvotes.some(r=>r.toString()===l.toString())?"upvote":null),l&&Array.isArray(t.downvotes)&&t.downvotes.some(r=>r.toString()===l.toString())&&h("downvote"),l&&Array.isArray(t.savedBy)&&N(t.savedBy.some(r=>r.toString()===l.toString()))},[t,l]);const B=async r=>{if(!sessionStorage.getItem("accessToken")){alert("Please log in to vote"),window.location.href="/login";return}try{const o=await F.votePost(t._id,r);o?.data?.data?.userVote?h(o.data.data.userVote==="up"?"upvote":o.data.data.userVote==="down"?"downvote":null):h(null),o?.data?.data&&$(_=>({..._,upvotes:o.data.data.upvotes||[],downvotes:o.data.data.downvotes||[]}))}catch(o){console.error("Error voting:",o),o.response?.status===401&&(alert("Please log in to vote"),window.location.href="/login")}},D=async()=>{if(!sessionStorage.getItem("accessToken")){alert("Please log in to save posts"),window.location.href="/login";return}try{await F.toggleSavePost(t._id),N(!b)}catch(n){console.error("Error saving post:",n),n.response?.status===401&&(alert("Please log in to save posts"),window.location.href="/login")}},V=async r=>{if(r.preventDefault(),!sessionStorage.getItem("accessToken")){alert("Please log in to report posts"),window.location.href="/login";return}if(!v.trim()){alert("Please provide a reason for reporting");return}A(!0);try{await J.createReport("Post",t._id,v),alert("Report submitted successfully. Thank you for helping keep our community safe."),d(!1),U("")}catch(o){console.error("Error reporting post:",o),o.response?.status===400?alert(o.response.data.message||"You have already reported this post"):o.response?.status===401?(alert("Please log in to report posts"),window.location.href="/login"):alert("Failed to submit report. Please try again.")}finally{A(!1)}},W=async()=>{if(!s&&t.commentCount>0){u(!0);try{const r=await H.getPostComments(t._id);y(r.data.comments||[])}catch(r){console.error("Error loading comments:",r)}finally{u(!1)}}w(!s)},O=r=>{const n=new Date,o=new Date(r),_=n-o,M=Math.floor(_/6e4),R=Math.floor(M/60),E=Math.floor(R/24);return E>0?`${E}d ago`:R>0?`${R}h ago`:M>0?`${M}m ago`:"just now"};return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:border-orange-500 transition-all duration-200 hover:shadow-lg max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"flex lg:flex-col flex-row items-center justify-center p-2 sm:p-3 lg:p-4 bg-gray-50 dark:bg-gray-900 rounded-t-lg lg:rounded-l-lg lg:rounded-t-none border-b lg:border-b-0 lg:border-r border-gray-200 dark:border-gray-700 gap-1 lg:gap-0",children:[e.jsxs("div",{className:"flex lg:flex-col flex-row items-center gap-1 lg:gap-0",children:[e.jsx("button",{onClick:()=>B("upvote"),disabled:!l,title:l?c==="upvote"?"Remove upvote":"Upvote":"Login to upvote",className:`p-1 sm:p-2 lg:p-3 rounded-lg transition-all duration-200 transform hover:scale-110 ${c==="upvote"?"text-orange-500 bg-orange-50 dark:bg-orange-900/20 shadow-md":l?"text-gray-400 hover:text-orange-500 hover:bg-gray-200 dark:hover:bg-gray-700":"text-gray-300 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})}),e.jsx("span",{className:`text-xs sm:text-sm lg:text-base font-bold lg:mt-2 px-1 sm:px-2 py-1 rounded ${c==="upvote"?"text-orange-500 bg-orange-50 dark:bg-orange-900/20":"text-gray-500 dark:text-gray-400"}`,children:Array.isArray(t.upvotes)?t.upvotes.length:t.upvotes||0})]}),e.jsxs("div",{className:"flex lg:flex-col flex-row items-center gap-1 lg:gap-0",children:[e.jsx("button",{onClick:()=>B("downvote"),disabled:!l,title:l?c==="downvote"?"Remove downvote":"Downvote":"Login to downvote",className:`p-1 sm:p-2 lg:p-3 rounded-lg transition-all duration-200 transform hover:scale-110 ${c==="downvote"?"text-blue-500 bg-blue-50 dark:bg-blue-900/20 shadow-md":l?"text-gray-400 hover:text-blue-500 hover:bg-gray-200 dark:hover:bg-gray-700":"text-gray-300 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})}),e.jsx("span",{className:`text-xs sm:text-sm lg:text-base font-bold lg:mt-2 px-1 sm:px-2 py-1 rounded ${c==="downvote"?"text-blue-500 bg-blue-50 dark:bg-blue-900/20":"text-gray-500 dark:text-gray-400"}`,children:Array.isArray(t.downvotes)?t.downvotes.length:t.downvotes||0})]})]}),e.jsxs("div",{className:"flex-1 p-4 lg:p-6 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm mb-3",children:[t.community?e.jsxs("span",{className:"bg-green-600/15 text-green-900 dark:bg-green-400/10 dark:text-green-200 rounded-full px-3 py-1 font-semibold text-xs",children:["g/",t.community.name||t.community.displayName]}):e.jsx("span",{className:"bg-blue-600/15 text-blue-900 dark:bg-blue-400/10 dark:text-blue-100 rounded-full px-3 py-1 font-semibold text-xs",children:"User Post"}),e.jsx("span",{className:"bg-orange-500/15 text-orange-900 dark:text-orange-300/20 dark:text-orange-100 rounded-full px-3 py-1 font-semibold text-xs",children:t.category?t.category.charAt(0).toUpperCase()+t.category.slice(1):"General"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300 hidden sm:inline",children:"•"}),e.jsxs("span",{className:"font-medium text-slate-700 dark:text-slate-200 cursor-pointer hover:underline transition-all duration-200",onClick:()=>{sessionStorage.getItem("accessToken")?S(!0):(j(!0),setTimeout(()=>j(!1),3e3))},children:["u/",t.author?.username||"Anonymous"]}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400 hidden sm:inline",children:"•"}),e.jsx("span",{className:"font-light text-slate-700 dark:text-slate-300",children:O(t.createdAt)})]}),e.jsx("h3",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 dark:text-white mb-3 hover:text-orange-500 cursor-pointer transition-colors duration-200",children:e.jsx(T,{to:`/post/${t._id}`,onClick:r=>{if(!sessionStorage.getItem("accessToken")){r.preventDefault(),alert("Please login to view the full post");return}},className:"hover:text-orange-500 transition-colors duration-200",children:t.title})}),t.content?.images&&t.content.images.length>0&&e.jsx("div",{className:"mb-4 space-y-2",children:t.content.images.map((r,n)=>e.jsx("div",{className:"rounded-lg overflow-hidden shadow-md",children:e.jsx("img",{src:r.secure_url,alt:t.title,className:"w-full h-auto max-h-96 sm:max-h-[500px] lg:max-h-[600px] object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"})},n))}),t.content?.links&&t.content.links.length>0&&e.jsx("div",{className:"mb-4 space-y-2",children:t.content.links.map((r,n)=>e.jsxs("div",{className:"flex items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 7a5 5 0 0 1 0 10H7a5 5 0 0 1 0-10h2"})}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline text-sm sm:text-base break-words font-medium",children:r.title||r.url})]},n))}),t.content?.text&&e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4 text-sm sm:text-base leading-relaxed line-clamp-3",children:t.content.text}),t.imageUrl&&!t.content?.images&&e.jsx("div",{className:"mb-4 rounded-lg overflow-hidden shadow-md",children:e.jsx("img",{src:t.imageUrl,alt:t.title,className:"w-full h-auto max-h-96 sm:max-h-[500px] lg:max-h-[600px] object-cover hover:scale-105 transition-transform duration-300",loading:"lazy"})}),t.linkUrl&&!t.content?.links&&e.jsxs("div",{className:"flex items-center mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 7a5 5 0 0 1 0 10H7a5 5 0 0 1 0-10h2"})}),e.jsx("a",{href:t.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline text-sm sm:text-base break-words font-medium",children:t.linkUrl})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 sm:gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-orange-500 transition-all duration-200",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsxs("span",{className:"font-medium",children:[t.commentCount||0," Comments"]})]}),e.jsxs("button",{onClick:D,disabled:!l,className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200 ${b?"bg-orange-100 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400":"hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-orange-500"} ${l?"":"cursor-not-allowed opacity-50"}`,children:[e.jsx("svg",{className:"w-5 h-5",fill:b?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),e.jsx("span",{className:"font-medium",children:b?"Saved":"Save"})]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-orange-500 transition-all duration-200",onClick:()=>{const r=t.content?.text||t.title;navigator.share?navigator.share({title:t.title,text:r,url:window.location.origin+`/post/${t._id}`}):(navigator.clipboard.writeText(window.location.origin+`/post/${t._id}`),alert("Link copied to clipboard!"))},children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.885 12.938 9 12.482 9 12c0-.482-.115-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),e.jsx("span",{className:"font-medium",children:"Share"})]}),e.jsxs("button",{onClick:()=>d(!0),disabled:!l,className:`flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200 ${l?"hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-red-500":"cursor-not-allowed opacity-50"}`,title:l?"Report this post":"Login to report posts",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"font-medium",children:"Report"})]})]}),s&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx(G,{postId:t._id,onCommentUpdate:m})}),P&&t.author?._id&&e.jsx(Y,{userId:t.author._id,onClose:()=>S(!1)}),L&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 w-full max-w-sm text-center",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:"Please login to see user profile"}),e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:"OK"})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Report Post"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4 text-sm",children:"Please provide a reason for reporting this post. Your report will be reviewed by our moderators."}),e.jsxs("form",{onSubmit:V,children:[e.jsx("textarea",{value:v,onChange:r=>U(r.target.value),placeholder:"Describe why you're reporting this post...",className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg resize-none focus:ring-2 focus:ring-red-500 focus:border-transparent dark:bg-gray-700 dark:text-white",rows:4,maxLength:500,required:!0}),e.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>{d(!1),U("")},className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:z||!v.trim(),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:z?"Reporting...":"Submit Report"})]})]})]})})]})]})})}export{re as P};
