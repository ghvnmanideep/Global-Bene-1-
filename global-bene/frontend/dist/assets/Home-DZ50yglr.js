import{j as e}from"./ui-BaUVVAjf.js";import{r as a,u as B}from"./router-DiqerDgP.js";import{p}from"./postService-B9nmksEV.js";import{c as k}from"./index-DDEPdpRf.js";import{u as E}from"./userService-D_cfKFZn.js";import{P as N}from"./PostCard-hk6ZiPN9.js";import _ from"./CommunityList-2lIvCtvY.js";import"./vendor-Bzgz95E1.js";import"./CommentSection-BssdT6Od.js";import"./authService-BKeytffR.js";import"./reportService-D7gKbnWI.js";function V({darkMode:S}){const[u,y]=a.useState([]),[C,b]=a.useState([]),[P,A]=a.useState(!0),[l,m]=a.useState("hot"),[s,f]=a.useState(1),[x]=a.useState(20),[n,U]=a.useState(1);B();const[h,D]=a.useState("all"),[o,L]=a.useState("all"),[d,$]=a.useState(""),[i,v]=a.useState({posts:[],users:[]}),[F,R]=a.useState(!1),[M,j]=a.useState(!1);a.useEffect(()=>{(async()=>{try{const[r,c]=await Promise.all([p.getAllPosts({sortBy:l,page:s,limit:x,category:h,search:d}).catch(()=>({data:{posts:[],pagination:{pages:1}}})),k.getAllCommunities({limit:5})]);y(r.data.posts||[]);const g=r.data.pagination;U(g&&g.pages||1),b(c.data.communities||[])}catch{}finally{A(!1)}})()},[l,s,x,h,d]);const w=async t=>{t?.preventDefault(),j(!0),R(!0);try{let r=[],c=[];(o==="posts"||o==="all")&&(r=(await p.getAllPosts({search:d,limit:10})).data.posts),(o==="users"||o==="all")&&(c=(await E.searchUsers({search:d,limit:10})).data.users),v({posts:r,users:c})}catch{v({posts:[],users:[]})}finally{j(!1)}};return sessionStorage.getItem("token"),e.jsxs("div",{className:`min-h-screen font-sans ${S?"bg-gray-900 text-gray-100":"bg-gray-50 text-gray-900"} transition-colors duration-500`,children:[e.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 md:gap-6",children:[e.jsxs("div",{className:"w-full lg:flex-1 min-w-0",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg mb-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-2",children:[e.jsx("button",{onClick:()=>m("hot"),className:`px-3 md:px-4 py-2 rounded text-sm font-semibold ${l==="hot"?"bg-gray-100 dark:bg-gray-700 text-orange-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:"ðŸ”¥ Hot"}),e.jsx("button",{onClick:()=>m("new"),className:`px-3 md:px-4 py-2 rounded text-sm font-semibold ${l==="new"?"bg-gray-100 dark:bg-gray-700 text-orange-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:"â­ New"}),e.jsx("button",{onClick:()=>m("top"),className:`px-3 md:px-4 py-2 rounded text-sm font-semibold ${l==="top"?"bg-gray-100 dark:bg-gray-700 text-orange-500":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:"â¬†ï¸ Top"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 mb-4 md:mb-6 bg-slate-50 dark:bg-slate-900 p-3 md:p-4 rounded-lg",children:[e.jsxs("select",{value:o,onChange:t=>L(t.target.value),className:"w-full sm:w-auto p-2 border rounded bg-white dark:bg-slate-800 dark:text-white shadow text-sm",children:[e.jsx("option",{value:"all",children:"All"}),e.jsx("option",{value:"posts",children:"Posts"}),e.jsx("option",{value:"users",children:"Users"})]}),e.jsx("input",{value:d,onChange:t=>$(t.target.value),className:"flex-1 w-full sm:w-auto p-2 border border-gray-400 dark:border-slate-600 rounded bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 shadow text-sm",placeholder:"Search anything..."}),e.jsx("button",{onClick:w,className:"w-full sm:w-auto bg-orange-600 dark:bg-orange-400 text-white dark:text-slate-900 px-4 py-2 rounded font-bold shadow hover:bg-orange-700 dark:hover:bg-orange-300 transition text-sm",children:"Search"})]}),F&&e.jsx("div",{className:"mb-6",children:M?e.jsx("div",{className:"text-center",children:"Loadingâ€¦"}):i.posts.length===0&&i.users.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No results found."}):e.jsxs(e.Fragment,{children:[o!=="users"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold mb-2 mt-2",children:"Posts"}),e.jsx("div",{className:"space-y-4",children:i.posts.map(t=>e.jsx(N,{post:t,onUpdate:()=>w()},t._id))})]}),o!=="posts"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold mb-2 mt-4",children:"Users"}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:i.users.map(t=>e.jsxs("div",{className:"flex items-center py-3 gap-3",children:[e.jsx("img",{src:t.profile?.avatarUrl||"https://www.gravatar.com/avatar/?d=mp",alt:t.username,className:"w-10 h-10 rounded-full object-cover border-2 border-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-base text-gray-900 dark:text-white",children:t.username}),e.jsx("div",{className:"text-gray-500 text-sm truncate",children:t.email})]}),e.jsx("span",{className:"inline-block px-2 py-1 text-xs rounded bg-blue-100 text-blue-800",children:t.role})]},t._id))})]})]})}),P?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-8 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading posts..."})}):u.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-8 text-center",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No posts yet."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:u.map(t=>e.jsx(N,{post:t,onUpdate:()=>{p.getAllPosts({sortBy:l,page:s,limit:x,category:h,search:d}).then(r=>y(r.data.posts||[]))}},t._id))}),e.jsxs("div",{className:"mt-4 md:mt-6 flex flex-col sm:flex-row items-center justify-center gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>f(t=>Math.max(1,t-1)),disabled:s<=1,className:`px-3 py-2 rounded border text-sm ${s<=1?"opacity-50 cursor-not-allowed":"hover:bg-gray-100 dark:hover:bg-gray-700"} border-gray-300 dark:border-gray-700 w-full sm:w-auto`,children:"Prev"}),e.jsx("button",{onClick:()=>f(t=>Math.min(t+1,n)),disabled:s>=n,className:`px-3 py-2 rounded border text-sm ${s>=n?"opacity-50 cursor-not-allowed":"hover:bg-gray-100 dark:hover:bg-gray-700"} border-gray-300 dark:border-gray-700 w-full sm:w-auto`,children:"Next"})]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:["Page ",s," of ",n]})]})]})]}),e.jsx("aside",{className:"w-full lg:w-80 space-y-4 order-first lg:order-last",children:e.jsx(_,{communities:C,onJoin:()=>{k.getAllCommunities({limit:5}).then(t=>b(t.data.communities||[]))}})})]})}),e.jsxs("footer",{className:"border-t border-gray-200 dark:border-gray-700 text-center py-12 text-gray-500 dark:text-gray-400",children:["Â© ",new Date().getFullYear()," Global Bene. All rights reserved."]})]})}export{V as default};
