import{j as T}from"./ui-BaUVVAjf.js";import{r as t,b as A,u as B}from"./router-DiqerDgP.js";import{a as H}from"./index-DDEPdpRf.js";function J(o={}){const{nonce:n,onScriptLoadSuccess:i,onScriptLoadError:r}=o,[s,e]=t.useState(!1),u=t.useRef(i);u.current=i;const v=t.useRef(r);return v.current=r,t.useEffect(()=>{const l=document.createElement("script");return l.src="https://accounts.google.com/gsi/client",l.async=!0,l.defer=!0,l.nonce=n,l.onload=()=>{var c;e(!0),(c=u.current)===null||c===void 0||c.call(u)},l.onerror=()=>{var c;e(!1),(c=v.current)===null||c===void 0||c.call(v)},document.body.appendChild(l),()=>{document.body.removeChild(l)}},[n]),s}const R=t.createContext(null);function U({clientId:o,nonce:n,onScriptLoadSuccess:i,onScriptLoadError:r,children:s}){const e=J({nonce:n,onScriptLoadSuccess:i,onScriptLoadError:r}),u=t.useMemo(()=>({clientId:o,scriptLoadedSuccessfully:e}),[o,e]);return A.createElement(R.Provider,{value:u},s)}function V(){const o=t.useContext(R);if(!o)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return o}function $(o){var n;return(n=o?.clientId)!==null&&n!==void 0?n:o?.client_id}const q={large:40,medium:32,small:20};function z({onSuccess:o,onError:n,useOneTap:i,promptMomentNotification:r,type:s="standard",theme:e="outline",size:u="large",text:v,shape:l,logo_alignment:c,width:p,locale:x,click_listener:M,containerProps:g,...N}){const C=t.useRef(null),{clientId:I,scriptLoadedSuccessfully:j}=V(),k=t.useRef(o);k.current=o;const w=t.useRef(n);w.current=n;const O=t.useRef(r);return O.current=r,t.useEffect(()=>{var m,_,S,h,y,b,G,L,E;if(j)return(S=(_=(m=window?.google)===null||m===void 0?void 0:m.accounts)===null||_===void 0?void 0:_.id)===null||S===void 0||S.initialize({client_id:I,callback:d=>{var a;if(!d?.credential)return(a=w.current)===null||a===void 0?void 0:a.call(w);const{credential:f,select_by:P}=d;k.current({credential:f,clientId:$(d),select_by:P})},...N}),(b=(y=(h=window?.google)===null||h===void 0?void 0:h.accounts)===null||y===void 0?void 0:y.id)===null||b===void 0||b.renderButton(C.current,{type:s,theme:e,size:u,text:v,shape:l,logo_alignment:c,width:p,locale:x,click_listener:M}),i&&((E=(L=(G=window?.google)===null||G===void 0?void 0:G.accounts)===null||L===void 0?void 0:L.id)===null||E===void 0||E.prompt(O.current)),()=>{var d,a,f;i&&((f=(a=(d=window?.google)===null||d===void 0?void 0:d.accounts)===null||a===void 0?void 0:a.id)===null||f===void 0||f.cancel())}},[I,j,i,s,e,u,v,l,c,p,x]),A.createElement("div",{...g,ref:C,style:{height:q[u],...g?.style}})}function D(){const o=B(),n=async i=>{try{const{credential:r}=i,e=(await H.post("/auth/google",{token:r})).data;sessionStorage.setItem("user",JSON.stringify({_id:e.user._id,username:e.user.username,email:e.user.email,role:e.user.role,accessToken:e.token})),sessionStorage.setItem("accessToken",e.token),window.dispatchEvent(new Event("authChange")),console.log("✅ Google Login Success:",e.user),o("/dashboard")}catch(r){console.error("❌ Google login error:",r),alert("Google login failed. Please try again.")}};return T.jsx(z,{onSuccess:n,onError:()=>alert("Google login failed")})}const W=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));export{U as G,D as a,W as b};
