import{j as e}from"./ui-BaUVVAjf.js";import{c as U,r as o,L as x}from"./router-DiqerDgP.js";import{p as M}from"./postService-B9nmksEV.js";import{c as d}from"./index-DDEPdpRf.js";import{C as L}from"./CommentSection-BssdT6Od.js";import"./vendor-Bzgz95E1.js";function A(){const{id:g}=U(),[t,v]=o.useState(null),[a,u]=o.useState(null),[m,N]=o.useState([]),[h,b]=o.useState(!1),[y,p]=o.useState(!1),[w,f]=o.useState(!0),[j,C]=o.useState("");if(o.useEffect(()=>{(async()=>{try{f(!0);const s=await M.getPostById(g);if(v(s.data),s.data.community&&s.data.community._id){const l=await d.getCommunityById(s.data.community._id);u(l.data);const i=sessionStorage.getItem("user")?JSON.parse(sessionStorage.getItem("user")):null;i&&l.data.members&&b(l.data.members.some(n=>n._id===i._id));try{const n=await d.getCommunityMembers(s.data.community._id);N(n.data.members.slice(0,10))}catch(n){console.error("Error loading community members:",n)}}}catch(s){console.error("Error loading post:",s),C("Could not load post")}finally{f(!1)}})()},[g]),w)return e.jsx("div",{className:"p-8 text-center text-gray-700 dark:text-gray-200",children:"Loading…"});if(j)return e.jsx("div",{className:"p-8 text-center text-red-600 dark:text-red-400",children:j});if(!t)return null;const S=r=>{const s=new Date,l=new Date(r),i=s-l,n=Math.floor(i/6e4),c=Math.floor(n/60),k=Math.floor(c/24);return k>0?`${k}d ago`:c>0?`${c}h ago`:n>0?`${n}m ago`:"just now"},_=async()=>{if(a){p(!0);try{await d.toggleJoinCommunity(a._id);const r=await d.getCommunityById(a._id);u(r.data);const s=sessionStorage.getItem("user")?JSON.parse(sessionStorage.getItem("user")):null;s&&r.data.members&&b(r.data.members.some(l=>l._id===s._id))}catch(r){console.error("Error toggling membership:",r)}finally{p(!1)}}};return e.jsx("div",{className:"max-w-7xl mx-auto my-10 px-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm mb-4",children:[t.community?e.jsxs("span",{className:"bg-green-600/15 text-green-900 dark:bg-green-400/10 dark:text-green-200 rounded px-2 font-semibold",children:["Community: g/",t.community.name||t.community.displayName]}):e.jsx("span",{className:"bg-blue-600/15 text-blue-900 dark:bg-blue-400/10 dark:text-blue-100 rounded px-2 font-semibold",children:"User Post"}),e.jsx("span",{className:"bg-orange-500/15 text-orange-900 dark:text-orange-300/20 dark:text-orange-100 rounded px-2 font-semibold ml-2",children:t.category?t.category.charAt(0).toUpperCase()+t.category.slice(1):"General"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"•"}),e.jsxs("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:["Posted by u/",t.author?.username||"Anonymous"]}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"•"}),e.jsx("span",{className:"font-light text-slate-700 dark:text-slate-300",children:S(t.createdAt)})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:t.title}),t.imageUrl&&e.jsx("img",{src:t.imageUrl,alt:t.title,className:"w-full rounded-lg mb-4 max-h-96 object-cover"}),t.linkUrl&&e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("svg",{className:"w-4 h-4 mr-1 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 7a5 5 0 0 1 0 10H7a5 5 0 0 1 0-10h2"})}),e.jsx("a",{href:t.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline break-words",children:t.linkUrl})]}),t.content?.text&&e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-6 whitespace-pre-wrap",children:t.content.text}),t.content?.images&&t.content.images.length>0&&e.jsx("div",{className:"mb-6 space-y-2",children:t.content.images.map((r,s)=>e.jsx("div",{className:"rounded-lg overflow-hidden shadow-md",children:e.jsx("img",{src:r.secure_url,alt:t.title,className:"w-full h-auto max-h-96 object-cover",loading:"lazy"})},s))}),t.content?.links&&t.content.links.length>0&&e.jsx("div",{className:"mb-6 space-y-2",children:t.content.links.map((r,s)=>e.jsxs("div",{className:"flex items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 7a5 5 0 0 1 0 10H7a5 5 0 0 1 0-10h2"})}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline break-words font-medium",children:r.title||r.url})]},s))}),t.imageUrl&&!t.content?.images&&e.jsx("div",{className:"mb-6 rounded-lg overflow-hidden shadow-md",children:e.jsx("img",{src:t.imageUrl,alt:t.title,className:"w-full h-auto max-h-96 object-cover",loading:"lazy"})}),t.linkUrl&&!t.content?.links&&e.jsxs("div",{className:"flex items-center mb-6 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("svg",{className:"w-5 h-5 mr-2 text-blue-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 7a5 5 0 0 1 0 10H7a5 5 0 0 1 0-10h2"})}),e.jsx("a",{href:t.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline break-words font-medium",children:t.linkUrl})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400 mb-6",children:[e.jsxs("span",{children:[t.upvotes||0," upvotes"]}),e.jsxs("span",{children:[t.downvotes||0," downvotes"]}),e.jsxs("span",{children:[t.commentCount||0," comments"]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-900 dark:text-white",children:"Comments"}),e.jsx(L,{postId:t._id,onCommentUpdate:()=>{}})]})]})}),a&&e.jsx("div",{className:"w-full lg:w-80",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("img",{src:a.iconUrl||"https://www.gravatar.com/avatar/?d=mp",alt:a.displayName,className:"w-12 h-12 rounded-full object-cover border-2 border-orange-500"}),e.jsxs("div",{children:[e.jsxs(x,{to:`/community/${a.name}`,className:"text-lg font-bold text-gray-900 dark:text-white hover:text-orange-500 transition-colors",children:["g/",a.name]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.displayName})]})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-4",children:a.description}),e.jsxs("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-gray-900 dark:text-white",children:a.members?.length||0}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Members"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-gray-900 dark:text-white",children:a.postCount||0}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Posts"})]})]}),sessionStorage.getItem("accessToken")&&e.jsx("button",{onClick:_,disabled:y,className:`w-full mb-4 px-4 py-2 rounded-lg font-semibold ${h?"bg-gray-500 hover:bg-gray-600 text-white":"bg-orange-500 hover:bg-orange-600 text-white"} disabled:opacity-50`,children:y?"...":h?"Leave Community":"Join Community"}),m.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Members"}),e.jsxs("div",{className:"space-y-2",children:[m.slice(0,5).map(r=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:r.user.profile?.avatarUrl||"https://www.gravatar.com/avatar/?d=mp",alt:r.user.username,className:"w-6 h-6 rounded-full"}),e.jsx(x,{to:`/profile/${r.user._id}`,className:"text-sm text-gray-700 dark:text-gray-300 hover:text-orange-500 transition-colors",children:r.user.username}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:["(",r.role,")"]})]},r.user._id)),m.length>5&&e.jsxs(x,{to:`/community/${a.name}`,className:"text-sm text-orange-500 hover:text-orange-600 transition-colors",children:["View all ",a.members?.length||0," members →"]})]})]})]})})]})})}export{A as default};
