import{j as e}from"./ui-BaUVVAjf.js";import{c as oe,r,u as ne,L as u}from"./router-DiqerDgP.js";import{a as c}from"./authService-BKeytffR.js";import{P as z}from"./PostCard-hk6ZiPN9.js";import{p as b}from"./postService-B9nmksEV.js";import{c as le}from"./index-DDEPdpRf.js";import{c as ie}from"./CommentSection-BssdT6Od.js";import de from"./CreatePost-DlGY833L.js";import"./vendor-Bzgz95E1.js";import"./reportService-D7gKbnWI.js";function je(){const{id:g}=oe(),[o,w]=r.useState(null),[d,j]=r.useState(null),[v,C]=r.useState("");ne();const[S,N]=r.useState([]),[h,p]=r.useState(!1),[E,R]=r.useState([]),[F,T]=r.useState([]),[D,W]=r.useState([]),[M,L]=r.useState([]),[A,G]=r.useState([]),[m,f]=r.useState("posts"),[I,B]=r.useState(null),[H,y]=r.useState(!1),[O,k]=r.useState(0);r.useEffect(()=>{c.getMe().then(s=>w(s.data)).catch(()=>{w(null)})},[]),r.useEffect(()=>{g?c.getUserById(g).then(s=>j(s.data)).catch(s=>{console.error("Error fetching user profile:",s),C(o?"User not found":"Please login to see the users")}):j(null)},[g,o]);const l=d?._id||o?._id,i=!g||o&&d&&d._id===o._id,V=o&&d&&o.following&&o.following.some(s=>(typeof s=="object"?s._id:s)===d._id),$=async()=>{if(d?._id){const a=await c.getUserById(d._id);j(a.data)}const s=await c.getMe();w(s.data)},Y=async()=>{p(!0),await c.followUser(d._id),await $(),p(!1)},q=async()=>{p(!0),await c.unfollowUser(d._id),await $(),p(!1)},J=s=>{B(s),y(!0)},K=async s=>{if(window.confirm("Are you sure you want to delete this post?"))try{await b.deletePost(s);const a=await b.getAllPosts({author:l,limit:20});N(a.data.posts||[]),k(a.data.pagination?.total||0)}catch(a){console.error("Error deleting post:",a),alert("Failed to delete post")}},Q=async s=>{if(window.confirm("Are you sure you want to delete this comment?"))try{await ie.deleteComment(s);const a=await c.getUserComments(l);L(a.data.comments||[])}catch(a){console.error("Error deleting comment:",a),alert("Failed to delete comment")}},X=async()=>{y(!1);const s=await b.getAllPosts({author:l,limit:20});N(s.data.posts||[]),k(s.data.pagination?.total||0)};r.useEffect(()=>{async function s(){if(l)try{const a=await b.getAllPosts({author:l,limit:20});N(a.data.posts||[]),k(a.data.pagination?.total||0)}catch{}}s()},[l]);const t=d||o;r.useEffect(()=>{async function s(){if(!t)return;const a=t.followers||[],U=t.following||[];try{const n=a.map(x=>c.getUserById(x).catch(()=>({data:{username:"Unknown"}}))),te=U.map(x=>c.getUserById(x).catch(()=>({data:{username:"Unknown"}}))),ae=await Promise.all(n),re=await Promise.all(te);R(ae.map(x=>x.data)),T(re.map(x=>x.data))}catch(n){console.error("Error fetching user details:",n)}}s()},[t]),r.useEffect(()=>{async function s(){if(!(!i||!o))try{const n=await le.getUserSavedPosts();W(n.data.posts||[])}catch(n){console.error("Error fetching saved posts:",n)}}async function a(){if(!(!i||!o||!l))try{const n=await c.getUserComments(l);L(n.data.comments||[])}catch(n){console.error("Error fetching user comments:",n)}}async function U(){if(!(!i||!o||!l))try{const n=await c.getUserInteractionLogs(l);G(n.data.activities||[])}catch(n){console.error("Error fetching user activities:",n)}}s(),a(),U()},[i,l,o]);const P=t?.followers?.length||0,_=t?.following?.length||0,Z=O,ee=P===1?"Follower":"Followers",se="Following";return o?e.jsxs("div",{className:"max-w-3xl mx-auto mt-10 p-4",children:[e.jsxs("div",{className:"flex flex-col items-center bg-gradient-to-r from-orange-200 via-white to-orange-100 rounded-2xl shadow-lg p-8 mb-6 border border-orange-300",children:[e.jsx("img",{src:t.profile?.avatarUrl||"https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y",alt:`${t.username}'s avatar`,className:"w-32 h-32 rounded-full border-4 border-orange-500 shadow-lg mb-4 object-cover hover:scale-105 transition-transform"}),e.jsx("h1",{className:"text-4xl font-black text-orange-900 mb-1",children:t.username}),e.jsx("p",{className:"text-gray-500 mb-2",children:t.email}),t.googleId&&e.jsx("div",{className:"bg-blue-50 text-blue-600 px-2 py-1 rounded text-xs mb-2 font-medium",children:"Signed in with Google"}),d&&o&&!i&&e.jsx("div",{className:"my-2",children:V?e.jsx("button",{disabled:h,onClick:q,className:"bg-orange-200 text-orange-900 px-4 py-2 rounded-full shadow hover:bg-orange-300 font-semibold transition disabled:opacity-60",children:h?"Unfollowing...":"Unfollow"}):e.jsx("button",{disabled:h,onClick:Y,className:"bg-orange-500 text-white px-4 py-2 rounded-full shadow hover:bg-orange-600 font-semibold transition disabled:opacity-60",children:h?"Following...":"Follow"})}),e.jsxs("div",{className:"flex gap-10 justify-center mt-4 mb-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:P}),e.jsx("div",{className:"text-xs uppercase tracking-widest text-gray-700",children:ee})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:Z}),e.jsx("div",{className:"text-xs uppercase tracking-widest text-gray-700",children:"Posts"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:_}),e.jsx("div",{className:"text-xs uppercase tracking-widest text-gray-700",children:se})]})]}),i&&t.spamPostCount>0&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-center",children:[e.jsx("div",{className:"text-red-700 font-semibold",children:"Spam Activity Warning"}),e.jsxs("div",{className:"text-sm text-red-600 mt-1",children:["You have ",t.spamPostCount," spam post",t.spamPostCount!==1?"s":"",".",t.spamPostCount>=5&&" Your account is banned due to excessive spam."]})]}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[i&&e.jsx(u,{to:"/edit-profile",className:"bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-full font-bold shadow transition",children:"Edit Profile"}),e.jsx("button",{onClick:()=>document.getElementById("posts-section")?.scrollIntoView({behavior:"smooth"}),className:"bg-white hover:bg-orange-50 border border-orange-400 text-orange-700 px-6 py-2 rounded-full font-bold shadow ml-2 transition",children:"View Posts"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[e.jsxs("h3",{className:"font-bold mb-3 text-orange-700 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),"Followers (",P,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:E.length>0?E.map(s=>e.jsxs(u,{to:`/profile/${s._id}`,className:"flex items-center p-2 bg-orange-50 dark:bg-orange-900/20 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/30 transition",children:[e.jsx("img",{src:s.profile?.avatarUrl||"https://www.gravatar.com/avatar/?d=mp",alt:s.username,className:"w-8 h-8 rounded-full mr-3"}),e.jsxs("span",{className:"font-medium text-orange-700 dark:text-orange-300",children:["@",s.username]})]},s._id)):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No followers yet."})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow p-4",children:[e.jsxs("h3",{className:"font-bold mb-3 text-orange-700 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Following (",_,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:F.length>0?F.map(s=>e.jsxs(u,{to:`/profile/${s._id}`,className:"flex items-center p-2 bg-orange-50 dark:bg-orange-900/20 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/30 transition",children:[e.jsx("img",{src:s.profile?.avatarUrl||"https://www.gravatar.com/avatar/?d=mp",alt:s.username,className:"w-8 h-8 rounded-full mr-3"}),e.jsxs("span",{className:"font-medium text-orange-700 dark:text-orange-300",children:["@",s.username]})]},s._id)):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Not following anyone yet."})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"rounded-xl bg-white dark:bg-gray-800 p-4 shadow border border-orange-100",children:[e.jsx("h2",{className:"font-bold mb-2 text-orange-700",children:"Bio"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200 min-h-[40px]",children:t.profile?.bio||"No bio available."})]}),e.jsxs("div",{className:"rounded-xl bg-white dark:bg-gray-800 p-4 shadow border border-orange-100",children:[e.jsx("h2",{className:"font-bold mb-2 text-orange-700",children:"Mobile"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200 min-h-[32px]",children:t.profile?.mobile||"Not provided"})]}),e.jsxs("div",{className:"rounded-xl bg-white dark:bg-gray-800 p-4 shadow border border-orange-100",children:[e.jsx("h2",{className:"font-bold mb-2 text-orange-700",children:"Gender"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200 min-h-[32px]",children:t.profile?.gender||"Not specified"})]}),e.jsxs("div",{className:"rounded-xl bg-white dark:bg-gray-800 p-4 shadow border border-orange-100",children:[e.jsx("h2",{className:"font-bold mb-2 text-orange-700",children:"Date of Birth"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-200 min-h-[32px]",children:t.profile?.dob?new Date(t.profile.dob).toLocaleDateString():"Not specified"})]})]}),v&&e.jsx("p",{className:`mt-6 p-2 text-center rounded ${v.includes("success")?"bg-green-200 text-green-800":"bg-red-200 text-red-800"}`,children:v}),i&&e.jsx("div",{className:"mt-12 mb-6",children:e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{onClick:()=>f("posts"),className:`px-4 py-2 font-semibold ${m==="posts"?"text-orange-600 border-b-2 border-orange-600":"text-gray-600 hover:text-orange-600"}`,children:"Posts"}),e.jsx("button",{onClick:()=>f("saved"),className:`px-4 py-2 font-semibold ${m==="saved"?"text-orange-600 border-b-2 border-orange-600":"text-gray-600 hover:text-orange-600"}`,children:"Saved Posts"}),e.jsx("button",{onClick:()=>f("comments"),className:`px-4 py-2 font-semibold ${m==="comments"?"text-orange-600 border-b-2 border-orange-600":"text-gray-600 hover:text-orange-600"}`,children:"Comments"}),e.jsx("button",{onClick:()=>f("activities"),className:`px-4 py-2 font-semibold ${m==="activities"?"text-orange-600 border-b-2 border-orange-600":"text-gray-600 hover:text-orange-600"}`,children:"Activity Logs"})]})}),e.jsxs("div",{id:"posts-section",className:"mt-12",children:[m==="posts"&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 text-orange-800",children:["Posts by ",t.username]}),S.length===0?e.jsx("p",{className:"p-8 text-center text-gray-500",children:"No posts yet."}):e.jsx("div",{className:"space-y-4",children:S.filter(s=>s.author&&s.author._id===l).map(s=>e.jsxs("div",{className:"relative",children:[e.jsx(z,{post:s,onUpdate:()=>{}}),i&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[e.jsx("button",{onClick:()=>J(s),className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>K(s._id),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm",children:"Delete"})]})]},s._id))})]}),m==="saved"&&i&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-orange-800",children:"Saved Posts"}),D.length===0?e.jsx("p",{className:"p-8 text-center text-gray-500",children:"No saved posts yet."}):e.jsx("div",{className:"space-y-4",children:D.map(s=>e.jsx(z,{post:s,onUpdate:()=>{}},s._id))})]}),m==="comments"&&i&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-orange-800",children:"My Comments"}),M.length===0?e.jsx("p",{className:"p-8 text-center text-gray-500",children:"No comments yet."}):e.jsx("div",{className:"space-y-4",children:M.map(s=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsxs(u,{to:`/post/${s.post._id}`,className:"text-lg font-semibold text-orange-600 hover:text-orange-800 underline",children:["On: ",s.post.title]}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:s.content}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("span",{children:["ðŸ‘ ",s.upvotes||0," upvotes"]}),e.jsxs("span",{className:"ml-4",children:["ðŸ‘Ž ",s.downvotes||0," downvotes"]})]})]}),e.jsx("button",{onClick:()=>Q(s._id),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm ml-4",children:"Delete"})]})},s._id))})]}),m==="activities"&&i&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-orange-800",children:"Activity Logs"}),A.length===0?e.jsx("p",{className:"p-8 text-center text-gray-500",children:"No activities yet."}):e.jsx("div",{className:"space-y-4",children:A.map(s=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"flex-shrink-0",children:[s.event_type.includes("login")&&e.jsx("span",{className:"text-2xl",children:"ðŸ”"}),s.event_type.includes("logout")&&e.jsx("span",{className:"text-2xl",children:"ðŸšª"}),s.event_type.includes("post")&&e.jsx("span",{className:"text-2xl",children:"ðŸ“"}),s.event_type.includes("comment")&&e.jsx("span",{className:"text-2xl",children:"ðŸ’¬"}),s.event_type.includes("vote")&&e.jsx("span",{className:"text-2xl",children:"ðŸ‘"}),s.event_type.includes("follow")&&e.jsx("span",{className:"text-2xl",children:"ðŸ‘¥"}),!["login","logout","post","comment","vote","follow"].some(a=>s.event_type.includes(a))&&e.jsx("span",{className:"text-2xl",children:"ðŸ“‹"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white capitalize",children:s.event_type.replace("_"," ")}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.timestamp).toLocaleString()})]}),e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:[s.entity_type," interaction"]}),s.props&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[s.props.browser&&e.jsxs("p",{children:[e.jsx("strong",{children:"Browser:"})," ",s.props.browser]}),s.props.platform&&e.jsxs("p",{children:[e.jsx("strong",{children:"Platform:"})," ",s.props.platform]}),s.props.ip_address&&e.jsxs("p",{children:[e.jsx("strong",{children:"IP:"})," ",s.props.ip_address]})]})]})]})},s.event_id))})]})]}),H&&I&&e.jsx(de,{onClose:()=>{y(!1),B(null)},onSuccess:X,communities:[],editPost:I})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 text-gray-700 dark:text-gray-300",children:"Loading profile or redirecting to login..."})}export{je as default};
