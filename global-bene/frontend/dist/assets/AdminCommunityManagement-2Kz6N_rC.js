import{j as e}from"./ui-BaUVVAjf.js";import{r}from"./router-DiqerDgP.js";import{a as x}from"./authService-BKeytffR.js";import"./vendor-Bzgz95E1.js";import"./index-DDEPdpRf.js";const $=()=>{const[n,v]=r.useState([]),[b,p]=r.useState(!0),[y,N]=r.useState(null),[l,f]=r.useState(1),[i,C]=r.useState(null),[u,w]=r.useState(""),[c,P]=r.useState("all"),[k,m]=r.useState(!1),[h,j]=r.useState(null),[a,d]=r.useState({displayName:"",description:"",isPrivate:!1,rules:[]});r.useEffect(()=>{o()},[l,u,c]);const o=async()=>{try{p(!0);const s=await x.admin.getAllCommunities({page:l,limit:20,search:u.trim()||void 0,isPrivate:c!=="all"?c:void 0});v(s.data.communities),C(s.data.pagination)}catch(s){N("Failed to load communities"),console.error("Communities fetch error:",s)}finally{p(!1)}},S=async(s,t)=>{if(confirm(`Are you sure you want to delete the community "${t}"? This will delete all posts and comments in the community. This action cannot be undone.`))try{await x.admin.deleteCommunity(s),alert("Community deleted successfully"),o()}catch(g){alert("Failed to delete community"),console.error("Delete community error:",g)}},E=s=>{j(s),d({displayName:s.displayName,description:s.description||"",isPrivate:s.isPrivate,rules:s.rules||[]}),m(!0)},M=async()=>{try{await x.admin.updateCommunity(h._id,a),alert("Community updated successfully"),m(!1),j(null),o()}catch(s){alert("Failed to update community"),console.error("Update community error:",s)}},F=async(s,t,g,A)=>{if(confirm(`Are you sure you want to remove ${g} from ${A}?`))try{await x.admin.removeCommunityMember(s,t),alert("Member removed successfully"),o()}catch(D){alert("Failed to remove member"),console.error("Remove member error:",D)}};return b&&l===1?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Community Management"}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600",children:"Back to Dashboard"})]}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-600",children:y})}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"All Communities"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:c,onChange:s=>P(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Communities"}),e.jsx("option",{value:"false",children:"Public Only"}),e.jsx("option",{value:"true",children:"Private Only"})]}),e.jsx("input",{type:"text",placeholder:"Search communities...",value:u,onChange:s=>w(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600",children:"Search"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:i?.total||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Communities"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-500",children:n.filter(s=>!s.isPrivate).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Public Communities"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-500",children:n.filter(s=>s.isPrivate).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Private Communities"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-500",children:n.reduce((s,t)=>s+(t.memberCount||0),0)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Members"})]})]})]}),e.jsx("div",{className:"space-y-4",children:n.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 border-l-4 border-blue-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mr-3",children:s.displayName}),e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:["r/",s.name]}),s.isPrivate&&e.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full ml-2",children:"PRIVATE"})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["Created by ",e.jsx("span",{className:"font-medium",children:s.creator?.username}),e.jsx("span",{className:"mx-2",children:"â€¢"}),s.memberCount||0," members",e.jsx("span",{className:"mx-2",children:"â€¢"}),s.postCount||0," posts"]}),s.description&&e.jsx("p",{className:"text-gray-700 mb-3 line-clamp-2",children:s.description}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Created: ",new Date(s.createdAt).toLocaleString(),s.moderators&&s.moderators.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"â€¢"}),"Moderators: ",s.moderators.map(t=>t.username).join(", ")]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[e.jsx("button",{onClick:()=>E(s),className:"px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600",children:"Edit"}),e.jsx("button",{onClick:()=>S(s._id,s.displayName),className:"px-3 py-2 bg-red-500 text-white text-sm rounded hover:bg-red-600",children:"Delete Community"})]})]}),s.members&&s.members.length>0&&e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:["Recent Members (",s.members.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.members.slice(0,5).map(t=>e.jsxs("div",{className:"flex items-center bg-gray-100 rounded-full px-3 py-1",children:[e.jsx("span",{className:"text-sm text-gray-700",children:t.username}),e.jsx("button",{onClick:()=>F(s._id,t._id,t.username,s.displayName),className:"ml-2 text-red-500 hover:text-red-700",title:"Remove member",children:"Ã—"})]},t._id)),s.members.length>5&&e.jsxs("span",{className:"text-sm text-gray-500 px-3 py-1",children:["+",s.members.length-5," more"]})]})]})]},s._id))}),i&&i.pages>1&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[e.jsx("button",{onClick:()=>f(Math.max(1,l-1)),disabled:l===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700",children:["Page ",l," of ",i.pages]}),e.jsx("button",{onClick:()=>f(Math.min(i.pages,l+1)),disabled:l===i.pages,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})}),n.length===0&&!b&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ˜ï¸"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Communities Found"}),e.jsx("p",{className:"text-gray-500",children:"No communities match your search criteria."})]}),k&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Edit Community: ",h.displayName]}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Name"}),e.jsx("input",{type:"text",value:a.displayName,onChange:s=>d({...a,displayName:s.target.value}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>d({...a,description:s.target.value}),rows:3,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-y"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Community Rules (one per line)"}),e.jsx("textarea",{value:a.rules.join(`
`),onChange:s=>d({...a,rules:s.target.value.split(`
`).filter(t=>t.trim())}),rows:4,placeholder:`1. Be respectful
2. No spam
3. Follow community guidelines`,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent resize-y"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:a.isPrivate,onChange:s=>d({...a,isPrivate:s.target.checked}),className:"w-4 h-4 text-orange-500 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Private community (members only)"})]})]}),e.jsxs("div",{className:"flex justify-end mt-6 space-x-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:M,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"Update Community"})]})]})})})]})};export{$ as default};
