import{j as e}from"./ui-BaUVVAjf.js";import{c as M,u as A,r as n}from"./router-DiqerDgP.js";import{c as m}from"./index-DDEPdpRf.js";import{p as F}from"./postService-B9nmksEV.js";import"./vendor-Bzgz95E1.js";function T(){const{id:i}=M(),j=A(),[c,y]=n.useState("settings"),[u,k]=n.useState(null),[p,N]=n.useState([]),[b,w]=n.useState([]),[C,v]=n.useState(!0),[f,g]=n.useState(""),[h,S]=n.useState(null),[r,d]=n.useState({displayName:"",description:"",rules:"",isPrivate:!1,iconUrl:"",bannerUrl:""});n.useEffect(()=>{x()},[i]);const x=async()=>{try{v(!0),g("");const t=sessionStorage.getItem("user");if(!t){g("User not authenticated");return}const o=JSON.parse(t);S(o);const a=await m.getCommunityById(i);if(!a.data){g("Community not found");return}const s=a.data;k(s),d({displayName:s.displayName||"",description:s.description||"",rules:Array.isArray(s.rules)?s.rules.join(`
`):s.rules||"",isPrivate:s.isPrivate||!1,iconUrl:s.iconUrl||"",bannerUrl:s.bannerUrl||""});try{const l=await m.getCommunityMembers(i);N(l.data.members||[])}catch(l){console.error("Error loading members:",l)}try{const l=await F.getAllPosts({communityId:i,limit:50});w(l.data.posts||[])}catch(l){console.error("Error loading posts:",l)}}catch(t){console.error("Error loading data:",t),g(t.response?.data?.message||"Failed to load community data")}finally{v(!1)}},P=async t=>{t.preventDefault();try{const o={...r,rules:r.rules.split(`
`).filter(a=>a.trim())};await m.updateCommunity(i,o),alert("Community updated successfully!"),x()}catch(o){console.error("Error updating community:",o);const a=o.response?.data?.message||"Failed to update community";alert(a)}},U=async(t,o)=>{if(window.confirm(`Are you sure you want to remove ${o} from this community?`))try{await m.removeMember(i,t),alert("Member removed successfully"),x()}catch(a){console.error("Error removing member:",a);const s=a.response?.data?.message||"Failed to remove member";alert(s)}},E=async(t,o)=>{if(window.confirm(`Are you sure you want to delete the post "${o}"?`))try{await m.deletePost(t),alert("Post deleted successfully"),x()}catch(a){console.error("Error deleting post:",a),alert("Failed to delete post")}},D=async()=>{if(window.confirm("Are you sure you want to delete this community? This action cannot be undone."))try{await m.deleteCommunity(i),alert("Community deleted successfully"),j("/communities")}catch(t){console.error("Error deleting community:",t),alert("Failed to delete community")}};return C?e.jsx("div",{className:"p-8 text-center",children:"Loading..."}):f?e.jsx("div",{className:"p-8 text-center text-red-600",children:f}):!u||!h?e.jsx("div",{className:"p-8 text-center",children:"Access denied"}):h._id===u.creator._id||h._id===u.creator?e.jsxs("div",{className:"max-w-6xl mx-auto my-10 px-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:["Edit Community: r/",u.name]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your community settings, members, and posts"})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700 mb-6",children:[e.jsx("button",{onClick:()=>y("settings"),className:`px-6 py-3 font-semibold ${c==="settings"?"border-b-2 border-orange-500 text-orange-500":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:"Settings"}),e.jsxs("button",{onClick:()=>y("members"),className:`px-6 py-3 font-semibold ${c==="members"?"border-b-2 border-orange-500 text-orange-500":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:["Members (",p.length,")"]}),e.jsxs("button",{onClick:()=>y("posts"),className:`px-6 py-3 font-semibold ${c==="posts"?"border-b-2 border-orange-500 text-orange-500":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:["Posts (",b.length,")"]})]}),c==="settings"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"Community Settings"}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Display Name"}),e.jsx("input",{type:"text",value:r.displayName,onChange:t=>d({...r,displayName:t.target.value}),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),e.jsx("textarea",{value:r.description,onChange:t=>d({...r,description:t.target.value}),rows:4,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Community Rules (one per line)"}),e.jsx("textarea",{value:r.rules,onChange:t=>d({...r,rules:t.target.value}),rows:6,className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:`1. Be respectful
2. No spam
3. Follow community guidelines`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Icon URL"}),e.jsx("input",{type:"url",value:r.iconUrl,onChange:t=>d({...r,iconUrl:t.target.value}),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Banner URL"}),e.jsx("input",{type:"url",value:r.bannerUrl,onChange:t=>d({...r,bannerUrl:t.target.value}),className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isPrivate",checked:r.isPrivate,onChange:t=>d({...r,isPrivate:t.target.checked}),className:"w-4 h-4 text-orange-500 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("label",{htmlFor:"isPrivate",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Private community (members only)"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",className:"px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg font-semibold",children:"Save Changes"}),e.jsx("button",{type:"button",onClick:D,className:"px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold",children:"Delete Community"})]})]})]}),c==="members"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"Community Members"}),e.jsx("div",{className:"space-y-4",children:p.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.user.profile?.avatarUrl||"https://www.gravatar.com/avatar/?d=mp",alt:t.user.username,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t.user.username}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:t.role})]})]}),t.role!=="creator"&&e.jsx("button",{onClick:()=>U(t.user._id,t.user.username),className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold",children:"Remove"})]},t.user._id))})]}),c==="posts"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"Community Posts"}),e.jsxs("div",{className:"space-y-4",children:[b.map(t=>e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-2",children:t.title}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["By u/",t.author?.username," • ",new Date(t.createdAt).toLocaleDateString()]}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:[t.upvotes||0," upvotes • ",t.commentCount||0," comments"]})]}),e.jsx("button",{onClick:()=>E(t._id,t.title),className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold ml-4",children:"Delete Post"})]})},t._id)),b.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No posts in this community yet."})]})]})]}):e.jsx("div",{className:"p-8 text-center",children:"Only community creators can edit communities"})}export{T as default};
